<html>
<head>
    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <!-- Calendar css -->
    <link rel='stylesheet' href='https://fullcalendar.io/js/fullcalendar-3.3.1/fullcalendar.min.css' />

    <!-- moment library (needed for date handling) -->
    <script src='https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.9.0/moment.min.js'></script>
    <!-- jQuery library -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
    <!-- Latest compiled Bootstrap -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <!-- Calendar javascript -->
    <script src='https://fullcalendar.io/js/fullcalendar-3.3.1/fullcalendar.min.js'></script>


    <!-- Google Fonts -->
    <link href='https://fonts.googleapis.com/css?family=Passion+One' rel='stylesheet' type='text/css'>

    <style>
        h1.title {
            font-size: 50px;
            font-family: 'Passion One', cursive;
            font-weight: 400;
        }




    </style>

    <script>
        var startDate = null;
        var endDate = null;

        var clearDates = function () {
            //clear dates if clicked third time
            startDate = null;
            endDate = null;
            $('#calendar').fullCalendar('unselect');


        };

        var updateDates = function () {
            var isNull = false;

            if (startDate != null) {
                $("#date1").text("Check-In: " + startDate.format('MMMM Do YYYY'));
            } else {
                isNull = true;
                $("#date1").text("Check-In: ???");
            }
            
            if (endDate != null) {
                $("#date2").text("Check-Out: " + endDate.format('MMMM Do YYYY'));
            } else {
                isNull = true;
                $("#date2").text("Check-Out: ???");
            }

            var btn = $("#openInfoModal");
            if (isNull) {
                    btn.addClass("disabled");
            } else {
                    btn.removeClass("disabled");
            }
        }

        $(document).ready(function () {

            //modal defaults
            $("#infoModal").attr("data-backdrop", "static");
            $("#infoModal").attr("data-keyboard", false);
            $("#infoModal").attr("data-show", false);

            $("#infoModal").modal();


            //modal close function
            $("#closeInfoModal").click(function () {
                $("#infoModal").modal("toggle");
            });

            $("#clearDates").click(function () {
                clearDates();
                updateDates();
            });

            $("#openInfoModal").click(function () {
                openInfo();
            });

            var openInfo = function () {
                $("#dateLabel").text("Rooms Available From " + startDate.format('MMMM Do YYYY') + " to " + endDate.format('MMMM Do YYYY'));
                $("#infoModal").modal("toggle");
            };

            var dayClicked = null;
        // page is now ready, initialize the calendar...
        $('#calendar').fullCalendar({
            //click event funtion
            selectable: true,
            selectHelper: true,

            dayClick: function (date, jsEvent, view) {

                //var today = new Date();
                //if (date.getTime() < today.getTime()) {
                  //  $(this).css('background-color', 'red');
                //}

                dayClicked = date.format();
                //alert('Clicked on: ' + date.format());

                //alert('Coordinates: ' + jsEvent.pageX + ',' + jsEvent.pageY);

                //alert('Current view: ' + view.name);

                //if the day is not in the past then open up the model
                if(date.isAfter(moment().subtract(1,'days') )  ) {
                    //if we don't have a start date
                    if (startDate == null) {
                        startDate = date;
                        endDate = null;

                    } else {
                        //if we have start but no end date
                        if (endDate == null) {
                            endDate = date;

                            //if you made the end date smaller, switch them
                            if (startDate.isAfter(endDate)) {
                                var tempDate = startDate;
                                startDate = endDate;
                                endDate = tempDate;
                            }

                           
                            if (startDate.format() != endDate.format()) {
                                openInfo();
                            } else {
                                endDate = null;
                            }
                        } else {
                            startDate = date;
                            endDate = null;

                        }
                    }

                } else {
                    clearDates();
                }

                updateDates();

            } //click function

        });

        //book rooms (use url to send the date and time to the bookingInfo.html)
        var getRoomUrl = function (roomNumber) {
            return "bookingInfo.html#in=" + startDate.format() + "&out=" + endDate.format() + "&room=" + roomNumber;
        }
            
        $("#room1").click(function () {
            window.location.href = getRoomUrl(1);
        });
        $("#room2").click(function () {
            window.location.href = getRoomUrl(2);
        });
        $("#room3").click(function () {
            window.location.href = getRoomUrl(3);
        });

    });



    
    </script>





</head>
<body>

    <nav class="navbar navbar-default">
        <div class="container-fluid">
            <div class="navbar-header">
                <a class="navbar-brand" href="login.html" style="color:dark-gray">Hotel Bookings</a>
            </div>
            <ul class="nav navbar-nav">
                <li><a href="index.html">Home</a></li>
                <li><a href="rooms.html">View Rooms</a></li>
                <li class="active"><a href="#">Book Room</a></li>
                <li><a href="contact.html">Contact Us</a></li>
            </ul>
        </div>
    </nav>


    <div class="container panel-title">
        <h1 class="title">Book Room</h1>


        <div class="row">
            <div class="col-sm-8" id='calendar'></div>
            <div class="col-sm-4">
                <div id="dates" class="row well">

                    <h4 id="date1">Check-In: ???</h4>
                    <h4 id="date2">Check-Out: ???</h4>
                    <button id="clearDates" type="button" class="btn btn-default">Clear</button>
                    <button id="openInfoModal" type="button" class="btn btn-primary disabled">View Availability</button>
                </div>
            </div>
        </div>
    </div>
    <!-- Room modal info-->
    <div id="infoModal" class="modal fade" role="dialog">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button id="closeInfoModal" type="button" class="close">&times;</button>
                    <h4 id="dateLabel" class="modal-title">Available Rooms</h4>
                </div>
                <div class="modal-body">
                    <button id ="room1" type="button" style="float:right" class="btn btn-success" > Select Room &check;</button>
                    <p><b>1. Penthouse Suite</b></p>
                    <p>Our most luxurious room available.</p>
                    <br>
                    <button id="room2" type="button" style="float:right" class="btn btn-success"> Select Room &check;</button>
                    <p><b>2. Prestige Room</b></p>
                    <p>Fine living and fun times.</p>
                    <br>
                    <button id="room3" type="button" style="float:right" class="btn btn-success" > Select Room &check;</button>
                    <p><b>3. Classic Room With a View</b></p>
                    <p>Affordable with a spin of luxury.</p>

                    <br>
                    <a href="rooms.html" style="color:#ff4927; font-size:13px">What are these?</a>
                </div>

            </div>
        </div>
    </div>


</body>
</html>

